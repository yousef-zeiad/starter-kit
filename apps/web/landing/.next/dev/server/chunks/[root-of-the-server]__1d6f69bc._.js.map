{
  "version": 3,
  "sources": [],
  "sections": [
    {
      "offset": {
        "line": 82,
        "column": 0
      },
      "map": {
        "version": 3,
        "sources": [
          "file:///Users/joezeiad/Desktop/Workspace/table-shift/packages/db/src/client.ts"
        ],
        "sourcesContent": [
          "import { createClient } from \"@supabase/supabase-js\";\nimport type { Database } from \"./types\";\n\n/**\n * Get environment variables with proper validation\n */\nfunction getEnvVar(key: string): string {\n  const value = process.env[key];\n  if (!value) {\n    throw new Error(`Missing required environment variable: ${key}`);\n  }\n  return value;\n}\n\n/**\n * Supabase client for server-side usage (Next.js API routes, server components, etc.)\n * Uses the service role key for admin operations\n */\nexport const supabaseAdmin = createClient<Database>(\n  getEnvVar(\"NEXT_PUBLIC_SUPABASE_URL\"),\n  getEnvVar(\"SUPABASE_SERVICE_ROLE_KEY\"),\n  {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  },\n);\n\n/**\n * Supabase client for client-side usage (browser, React Native)\n * Uses the anon key which respects Row Level Security policies\n */\nexport function createBrowserClient() {\n  return createClient<Database>(\n    getEnvVar(\"NEXT_PUBLIC_SUPABASE_URL\"),\n    getEnvVar(\"NEXT_PUBLIC_SUPABASE_ANON_KEY\"),\n    {\n      auth: {\n        persistSession: true,\n        autoRefreshToken: true,\n      },\n    },\n  );\n}\n\n/**\n * Create a Supabase client for React Native/Expo\n * This should be used in mobile apps with expo-secure-store for session persistence\n */\nexport function createMobileClient() {\n  return createClient<Database>(\n    getEnvVar(\"NEXT_PUBLIC_SUPABASE_URL\"),\n    getEnvVar(\"NEXT_PUBLIC_SUPABASE_ANON_KEY\"),\n    {\n      auth: {\n        persistSession: true,\n        autoRefreshToken: true,\n        // Note: You'll need to implement custom storage using expo-secure-store\n        // storage: customExpoSecureStoreAdapter,\n      },\n    },\n  );\n}\n"
        ],
        "names": [],
        "mappings": ";;;;;;;;AAAA;;AAGA;;CAEC,GACD,SAAS,UAAU,GAAW;IAC5B,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;IAC9B,IAAI,CAAC,OAAO;QACV,MAAM,IAAI,MAAM,CAAC,uCAAuC,EAAE,KAAK;IACjE;IACA,OAAO;AACT;AAMO,MAAM,gBAAgB,IAAA,6SAAY,EACvC,UAAU,6BACV,UAAU,8BACV;IACE,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;IAClB;AACF;AAOK,SAAS;IACd,OAAO,IAAA,6SAAY,EACjB,UAAU,6BACV,UAAU,kCACV;QACE,MAAM;YACJ,gBAAgB;YAChB,kBAAkB;QACpB;IACF;AAEJ;AAMO,SAAS;IACd,OAAO,IAAA,6SAAY,EACjB,UAAU,6BACV,UAAU,kCACV;QACE,MAAM;YACJ,gBAAgB;YAChB,kBAAkB;QAGpB;IACF;AAEJ",
        "debugId": null
      }
    },
    {
      "offset": {
        "line": 127,
        "column": 0
      },
      "map": {
        "version": 3,
        "sources": [
          "file:///Users/joezeiad/Desktop/Workspace/table-shift/apps/web/landing/src/env.ts"
        ],
        "sourcesContent": [
          "import { createEnv } from \"@t3-oss/env-nextjs\";\n// import { vercel } from \"@t3-oss/env-nextjs/presets-zod\";\n// import { authEnv } from \"@trading-platform/auth/env\";\nimport { z } from \"zod/v4\";\n\nexport const env = createEnv({\n  // extends: [authEnv(), vercel()],\n  shared: {\n    NODE_ENV: z\n      .enum([\"development\", \"production\", \"test\"])\n      .default(\"development\"),\n  },\n  server: {\n    RESEND_API_KEY: z.string().min(1).optional(),\n  },\n  /**\n   * Specify your server-side environment variables schema here.\n   * This way you can ensure the app isn't built with invalid env vars.\n   */\n  // server: {\n  //   POSTGRES_URL: z.url(),\n  // },\n\n  /**\n   * Specify your client-side environment variables schema here.\n   * For them to be exposed to the client, prefix them with `NEXT_PUBLIC_`.\n   */\n  client: {\n    // NEXT_PUBLIC_CLIENTVAR: z.string(),\n  },\n  /**\n   * Destructure all variables from `process.env` to make sure they aren't tree-shaken away.\n   */\n  experimental__runtimeEnv: {\n    NODE_ENV: process.env.NODE_ENV,\n\n    // NEXT_PUBLIC_CLIENTVAR: process.env.NEXT_PUBLIC_CLIENTVAR,\n  },\n  skipValidation:\n    !!process.env.CI || process.env.npm_lifecycle_event === \"lint\",\n});\n"
        ],
        "names": [],
        "mappings": ";;;;AAAA;AACA,2DAA2D;AAC3D,kDAAkD;AAClD;AAAA;;;AAEO,MAAM,MAAM,IAAA,oSAAS,EAAC;IAC3B,kCAAkC;IAClC,QAAQ;QACN,UAAU,qMAAC,CACR,IAAI,CAAC;YAAC;YAAe;YAAc;SAAO,EAC1C,OAAO,CAAC;IACb;IACA,QAAQ;QACN,gBAAgB,qMAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ;IAC5C;IACA;;;GAGC,GACD,YAAY;IACZ,2BAA2B;IAC3B,KAAK;IAEL;;;GAGC,GACD,QAAQ;IAER;IACA;;GAEC,GACD,0BAA0B;QACxB,QAAQ;IAGV;IACA,gBACE,CAAC,CAAC,QAAQ,GAAG,CAAC,EAAE,IAAI,QAAQ,GAAG,CAAC,mBAAmB,KAAK;AAC5D",
        "debugId": null
      }
    },
    {
      "offset": {
        "line": 172,
        "column": 0
      },
      "map": {
        "version": 3,
        "sources": [
          "file:///Users/joezeiad/Desktop/Workspace/table-shift/apps/web/landing/src/app/api/waitlist/route.ts"
        ],
        "sourcesContent": [
          "import type { SupabaseClient } from \"@supabase/supabase-js\";\nimport type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\nimport { z } from \"zod/v4\";\n\nimport type { Database } from \"@trading-platform/db/types\";\nimport { supabaseAdmin } from \"@trading-platform/db/client\";\n\nimport { env } from \"~/env\";\n\nconst supabaseAdminClient =\n  supabaseAdmin as unknown as SupabaseClient<Database>;\n\nconst optionalStringField = z\n  .union([z.string(), z.null(), z.undefined()])\n  .transform((value) => {\n    if (value == null) return null;\n    const trimmed = value.trim();\n    return trimmed.length > 0 ? trimmed : null;\n  });\n\nconst waitlistSchema = z.object({\n  email: z.string().trim().email(),\n  full_name: z.string().trim().min(1, \"Full name is required\"),\n  phone: optionalStringField,\n  restaurant_name: z.string().trim().min(1, \"Restaurant name is required\"),\n  number_of_locations: z\n    .number()\n    .int()\n    .positive(\"Number of locations must be positive\"),\n  biggest_challenge: optionalStringField,\n});\n\n/**\n * POST /api/waitlist\n * Add a new entry to the early access waitlist\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const body = (await request.json()) as unknown;\n\n    const result = waitlistSchema.safeParse(body);\n\n    if (!result.success) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: \"Invalid request payload\",\n          details:\n            env.NODE_ENV === \"production\"\n              ? undefined\n              : result.error.flatten().fieldErrors,\n        },\n        { status: 400 },\n      );\n    }\n\n    const {\n      email,\n      full_name,\n      phone,\n      restaurant_name,\n      number_of_locations,\n      biggest_challenge,\n    } = result.data;\n\n    // Insert into database\n    // Only store the essential form fields\n    // Note: No status field - progression tracked via invited_at and onboarded_at timestamps\n    const { data, error } = await supabaseAdminClient\n      .from(\"early_access_waitlist\")\n      .insert({\n        email: email.toLowerCase().trim(),\n        full_name,\n        phone,\n        restaurant_name,\n        number_of_locations,\n        biggest_challenge,\n      })\n      .select()\n      .single();\n\n    if (error) {\n      // Handle duplicate email error\n      if (error.code === \"23505\") {\n        return NextResponse.json(\n          { success: false, error: \"Email already registered\" },\n          { status: 409 },\n        );\n      }\n\n      console.error(\"Waitlist insert error:\", error);\n      return NextResponse.json(\n        {\n          success: false,\n          error: \"Failed to add to waitlist\",\n          details:\n            env.NODE_ENV === \"production\"\n              ? undefined\n              : {\n                  message: error.message,\n                  code: error.code,\n                  hint: error.hint,\n                  details: error.details,\n                },\n        },\n        { status: 500 },\n      );\n    }\n\n    try {\n      const functionResult = await supabaseAdminClient.functions.invoke<{\n        success?: boolean;\n      }>(\"waitlist-confirm\", {\n        body: {\n          email,\n          full_name,\n          restaurant_name,\n          number_of_locations,\n          biggest_challenge,\n        },\n      });\n\n      if (functionResult.error) {\n        console.error(\n          \"Waitlist confirmation function error:\",\n          functionResult.error,\n        );\n      }\n    } catch (invokeError) {\n      console.error(\"Waitlist confirmation invoke error:\", invokeError);\n    }\n\n    // Optional: Send confirmation email via Resend\n    // await sendConfirmationEmail(email, full_name);\n\n    // Optional: Send notification to Slack\n    // await notifySlack({ email, restaurant_name });\n\n    return NextResponse.json({ success: true, data });\n  } catch (error) {\n    console.error(\"Waitlist API error:\", error);\n    return NextResponse.json(\n      { success: false, error: \"Internal server error\" },\n      { status: 500 },\n    );\n  }\n}\n\n/**\n * GET /api/waitlist\n * Get all waitlist entries (admin only)\n * This should be protected with authentication in production\n */\nexport async function GET(_request: NextRequest) {\n  try {\n    // TODO: Add authentication check here\n    // const session = await getSession(request);\n    // if (!session || session.user.role !== 'admin') {\n    //   return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    // }\n\n    const { data, error } = await supabaseAdminClient\n      .from(\"early_access_waitlist\")\n      .select(\"*\")\n      .order(\"created_at\", { ascending: false });\n\n    if (error) {\n      console.error(\"Waitlist fetch error:\", error);\n      return NextResponse.json(\n        { success: false, error: \"Failed to fetch waitlist\" },\n        { status: 500 },\n      );\n    }\n\n    // Get stats\n    const { data: stats } = await supabaseAdminClient.rpc(\"get_waitlist_stats\");\n\n    return NextResponse.json({ success: true, data, stats });\n  } catch (error) {\n    console.error(\"Waitlist GET error:\", error);\n    return NextResponse.json(\n      { success: false, error: \"Internal server error\" },\n      { status: 500 },\n    );\n  }\n}\n"
        ],
        "names": [],
        "mappings": "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",
        "debugId": null
      }
    }
  ]
}
