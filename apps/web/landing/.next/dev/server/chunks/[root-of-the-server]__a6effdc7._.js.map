{
  "version": 3,
  "sources": [],
  "sections": [
    {
      "offset": {
        "line": 82,
        "column": 0
      },
      "map": {
        "version": 3,
        "sources": [
          "file:///Users/joezeiad/Desktop/Workspace/table-shift/packages/db/src/client.ts"
        ],
        "sourcesContent": [
          "import { createClient } from \"@supabase/supabase-js\";\nimport type { Database } from \"./types\";\n\n/**\n * Get environment variables with proper validation\n */\nfunction getEnvVar(key: string): string {\n  const value = process.env[key];\n  if (!value) {\n    throw new Error(`Missing required environment variable: ${key}`);\n  }\n  return value;\n}\n\n/**\n * Supabase client for server-side usage (Next.js API routes, server components, etc.)\n * Uses the service role key for admin operations\n */\nexport const supabaseAdmin = createClient<Database>(\n  getEnvVar(\"NEXT_PUBLIC_SUPABASE_URL\"),\n  getEnvVar(\"SUPABASE_SERVICE_ROLE_KEY\"),\n  {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  },\n);\n\n/**\n * Supabase client for client-side usage (browser, React Native)\n * Uses the anon key which respects Row Level Security policies\n */\nexport function createBrowserClient() {\n  return createClient<Database>(\n    getEnvVar(\"NEXT_PUBLIC_SUPABASE_URL\"),\n    getEnvVar(\"NEXT_PUBLIC_SUPABASE_ANON_KEY\"),\n    {\n      auth: {\n        persistSession: true,\n        autoRefreshToken: true,\n      },\n    },\n  );\n}\n\n/**\n * Create a Supabase client for React Native/Expo\n * This should be used in mobile apps with expo-secure-store for session persistence\n */\nexport function createMobileClient() {\n  return createClient<Database>(\n    getEnvVar(\"NEXT_PUBLIC_SUPABASE_URL\"),\n    getEnvVar(\"NEXT_PUBLIC_SUPABASE_ANON_KEY\"),\n    {\n      auth: {\n        persistSession: true,\n        autoRefreshToken: true,\n        // Note: You'll need to implement custom storage using expo-secure-store\n        // storage: customExpoSecureStoreAdapter,\n      },\n    },\n  );\n}\n"
        ],
        "names": [],
        "mappings": ";;;;;;;;AAAA;;AAGA;;CAEC,GACD,SAAS,UAAU,GAAW;IAC5B,MAAM,QAAQ,QAAQ,GAAG,CAAC,IAAI;IAC9B,IAAI,CAAC,OAAO;QACV,MAAM,IAAI,MAAM,CAAC,uCAAuC,EAAE,KAAK;IACjE;IACA,OAAO;AACT;AAMO,MAAM,gBAAgB,IAAA,6SAAY,EACvC,UAAU,6BACV,UAAU,8BACV;IACE,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;IAClB;AACF;AAOK,SAAS;IACd,OAAO,IAAA,6SAAY,EACjB,UAAU,6BACV,UAAU,kCACV;QACE,MAAM;YACJ,gBAAgB;YAChB,kBAAkB;QACpB;IACF;AAEJ;AAMO,SAAS;IACd,OAAO,IAAA,6SAAY,EACjB,UAAU,6BACV,UAAU,kCACV;QACE,MAAM;YACJ,gBAAgB;YAChB,kBAAkB;QAGpB;IACF;AAEJ",
        "debugId": null
      }
    },
    {
      "offset": {
        "line": 127,
        "column": 0
      },
      "map": {
        "version": 3,
        "sources": [
          "file:///Users/joezeiad/Desktop/Workspace/table-shift/apps/web/landing/src/app/api/waitlist/route.ts"
        ],
        "sourcesContent": [
          "import type { NextRequest } from \"next/server\";\nimport { NextResponse } from \"next/server\";\n\nimport { supabaseAdmin } from \"@trading-platform/db/client\";\nimport type { Database } from \"@trading-platform/db/types\";\nimport type { SupabaseClient } from \"@supabase/supabase-js\";\n\nconst supabaseAdminClient =\n  supabaseAdmin as unknown as SupabaseClient<Database>;\n\n/**\n * POST /api/waitlist\n * Add a new entry to the early access waitlist\n */\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n\n    const { email, full_name, phone, restaurant_name, number_of_locations } =\n      body;\n\n    // Validation\n    if (!email || typeof email !== \"string\") {\n      return NextResponse.json(\n        { success: false, error: \"Email is required\" },\n        { status: 400 },\n      );\n    }\n\n    // Insert into database\n    // Only store the essential form fields\n    // Note: No status field - progression tracked via invited_at and onboarded_at timestamps\n    // @ts-expect-error - Supabase Database types not yet generated\n    const { data, error } = await supabaseAdminClient\n      .from(\"early_access_waitlist\")\n      .insert({\n        email: email.toLowerCase().trim(),\n        full_name: full_name ?? null,\n        phone: phone ?? null,\n        restaurant_name: restaurant_name ?? null,\n        number_of_locations: number_of_locations ?? null,\n      })\n      .select()\n      .single();\n\n    if (error) {\n      // Handle duplicate email error\n      if (error.code === \"23505\") {\n        return NextResponse.json(\n          { success: false, error: \"Email already registered\" },\n          { status: 409 },\n        );\n      }\n\n      console.error(\"Waitlist insert error:\", error);\n      return NextResponse.json(\n        {\n          success: false,\n          error: \"Failed to add to waitlist\",\n          details:\n            process.env.NODE_ENV === \"production\"\n              ? undefined\n              : {\n                  message: error.message,\n                  code: error.code,\n                  hint: error.hint,\n                  details: error.details,\n                },\n        },\n        { status: 500 },\n      );\n    }\n\n    // Optional: Send confirmation email via Resend\n    // await sendConfirmationEmail(email, full_name);\n\n    // Optional: Send notification to Slack\n    // await notifySlack({ email, restaurant_name });\n\n    return NextResponse.json({ success: true, data });\n  } catch (error) {\n    console.error(\"Waitlist API error:\", error);\n    return NextResponse.json(\n      { success: false, error: \"Internal server error\" },\n      { status: 500 },\n    );\n  }\n}\n\n/**\n * GET /api/waitlist\n * Get all waitlist entries (admin only)\n * This should be protected with authentication in production\n */\nexport async function GET(_request: NextRequest) {\n  try {\n    // TODO: Add authentication check here\n    // const session = await getSession(request);\n    // if (!session || session.user.role !== 'admin') {\n    //   return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    // }\n\n    // @ts-expect-error - Supabase Database types not yet generated\n    const { data, error } = await supabaseAdminClient\n      .from(\"early_access_waitlist\")\n      .select(\"*\")\n      .order(\"created_at\", { ascending: false });\n\n    if (error) {\n      console.error(\"Waitlist fetch error:\", error);\n      return NextResponse.json(\n        { success: false, error: \"Failed to fetch waitlist\" },\n        { status: 500 },\n      );\n    }\n\n    // Get stats\n    // @ts-expect-error - Supabase Database types not yet generated\n    const { data: stats } = await supabaseAdminClient.rpc(\"get_waitlist_stats\");\n\n    return NextResponse.json({ success: true, data, stats });\n  } catch (error) {\n    console.error(\"Waitlist GET error:\", error);\n    return NextResponse.json(\n      { success: false, error: \"Internal server error\" },\n      { status: 500 },\n    );\n  }\n}\n"
        ],
        "names": [],
        "mappings": ";;;;;;AACA;AAEA;;;AAIA,MAAM,sBACJ,kJAAa;AAMR,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,KAAK,EAAE,eAAe,EAAE,mBAAmB,EAAE,GACrE;QAEF,aAAa;QACb,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU;YACvC,OAAO,mUAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAoB,GAC7C;gBAAE,QAAQ;YAAI;QAElB;QAEA,uBAAuB;QACvB,uCAAuC;QACvC,yFAAyF;QACzF,+DAA+D;QAC/D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,oBAC3B,IAAI,CAAC,yBACL,MAAM,CAAC;YACN,OAAO,MAAM,WAAW,GAAG,IAAI;YAC/B,WAAW,aAAa;YACxB,OAAO,SAAS;YAChB,iBAAiB,mBAAmB;YACpC,qBAAqB,uBAAuB;QAC9C,GACC,MAAM,GACN,MAAM;QAET,IAAI,OAAO;YACT,+BAA+B;YAC/B,IAAI,MAAM,IAAI,KAAK,SAAS;gBAC1B,OAAO,mUAAY,CAAC,IAAI,CACtB;oBAAE,SAAS;oBAAO,OAAO;gBAA2B,GACpD;oBAAE,QAAQ;gBAAI;YAElB;YAEA,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO,mUAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO;gBACP,SACE,sCACI,0BACA;oBACE,SAAS,MAAM,OAAO;oBACtB,MAAM,MAAM,IAAI;oBAChB,MAAM,MAAM,IAAI;oBAChB,SAAS,MAAM,OAAO;gBACxB;YACR,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,+CAA+C;QAC/C,iDAAiD;QAEjD,uCAAuC;QACvC,iDAAiD;QAEjD,OAAO,mUAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAK;IACjD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,mUAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAwB,GACjD;YAAE,QAAQ;QAAI;IAElB;AACF;AAOO,eAAe,IAAI,QAAqB;IAC7C,IAAI;QACF,sCAAsC;QACtC,6CAA6C;QAC7C,mDAAmD;QACnD,0EAA0E;QAC1E,IAAI;QAEJ,+DAA+D;QAC/D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,oBAC3B,IAAI,CAAC,yBACL,MAAM,CAAC,KACP,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QAE1C,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,yBAAyB;YACvC,OAAO,mUAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAA2B,GACpD;gBAAE,QAAQ;YAAI;QAElB;QAEA,YAAY;QACZ,+DAA+D;QAC/D,MAAM,EAAE,MAAM,KAAK,EAAE,GAAG,MAAM,oBAAoB,GAAG,CAAC;QAEtD,OAAO,mUAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;YAAM;QAAM;IACxD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,mUAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAwB,GACjD;YAAE,QAAQ;QAAI;IAElB;AACF",
        "debugId": null
      }
    }
  ]
}
